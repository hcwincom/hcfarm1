<script>
	var city_url = "{:url('portal/public/city')}";
	city(0);
	function city(city = 0) {
		var provinces = $("#provinces");
		$.post(city_url, { 'city': city }, function (data) {
			if (data.code != 1) {
				return false;
			}
			var citys = data.data.citys;
			var options = '';
			// console.log(citys);
			for (var i in citys) {
				options += '<option value="' + i + '">' + citys[i] + '</option>';
			}
			// console.log(options);
			provinces.append(options);

		}, 'json');
	}

	$("#provinces").change(function () {
		$.post(city_url, { 'city': $(this).val() }, function (data) {
			if (data.code != 1) {
				return false;
			}

			var citys = data.data.citys;
			var options = '';

			for (var i in citys) {
				options += '<option class="city2" value="' + i + '">' + citys[i] + '</option>';
			}

			$("#citysel .city2").remove();
			$("#countys .city3").remove();
			$("#citysel").append(options);
			$("#citysel .city0").prop('selected', true)

		}, 'json');
		$("#citysel").val();
	});
	$("#citysel").change(function () {
		$("#countys").val(0);
		$.post(city_url, { 'city': $(this).val() }, function (data) {
			if (data.code != 1) {
				return false;
			}
			var citys = data.data.citys;
			var options = '';

			for (var i in citys) {
				options += '<option class="city3" value="' + i + '">' + citys[i] + '</option>';
			}
			$("#countys .city3").remove();
			$("#countys").append(options);
			$("#countys .city0").prop('selected', true)


		}, 'json');
	})


//  验证提货券

$('#goods_verify').submit(function(){
	var form_check=pickGoods();
	console.log('ssssssss');
	if(form_check==false){
		return false;
	} 
	$('#info').hide();
	$(".cardGoods").hide();
	$(".personInfo").hide();

	var sn=$('#code').val();
	var psw=$('#password').val();
	var verify=$('#checkcode').val();
	$.post("{:url('portal/thj/verify')}",{'sn':sn,'psw':psw,'verify':verify},function(data){
		if(data.code!=1){
		 
			$(".indyz2").html(data.msg);
			$('.codeImg').attr('src',$('.codeImg').attr('src')+';1');
			return false;
		}
		//获取卡券数据赋值
		var info=data.data.info;
		console.log(info);
		$('#info').show();
		$('#info .show_price em').text(info['show_money']);
		$('#info .status em').remove();
		console.log("tt");
		console.log(info.sn);

		//按状态显示
		//         'voucher_status'=>[
//             1=>'系统生成',
//             2=>'已导出',
//             3=>'已发放',
//             4=>'已提货',
//             5=>'已发货',
//             6=>'已收货',
//             7=>'订单完成',
//             8=>'已退货',
//             9=>'售后结束',
//         ],
		console.log("dd");
		if(info.status=='3'){ 
			$('#info .status').append('<em class="redcolor">未提货</em>');
			$('#info').show();
			// $('.codeBtn').show();
			$(".personInfo").show();
			$("#codeNum").val(info.sn);
			$("#codePwd").val(info.psw);
			return false;
		} 
		//已提货显示提货信息
		if(info.status == '4'){
			$('#info .status').append('<em class="greenc">已提货</em>');
			$('#info').show();
			$(".cardGoods").show();
		}

		$('#myname').val(info['uname']);
		$('#myphone').val(info['utel']);
		$('#citySelect').text(info['city_name']);
		$('#myaddr').val(info['address']);
		$('#start').val(info['express_time']);
		 
		$('#address_btn').hide();
	},'json');
	
	return false;
});

//  

	
	// 提货信息验证
	$("#pickBtn").click(function () {
		if ($.trim($("#myname").val()) == "") {
			$("#myname").focus();
			$(".codeMsg").html("请填写联系人姓名");
			return false;
		} else if ($.trim($("#myphone").val()) == "" || isPhoneNo($.trim($("#myphone").val())) == false) {
			$("#myphone").focus();
			$(".codeMsg").html("请填写联系人手机号码");
			return false;
		} else if ($.trim($("#countys").val()) == "0") {
			$(".codeMsg").html("请填写地址");
			return false;
		} else if ($.trim($("#myaddr").text()) == "") {
			$("#myaddr").focus();
			$(".codeMsg").html("请填写详细地址");
			//return false;
		}
		var sncode = $("#codeNum").val();
		var pswcode = $("#codePwd").val();
		var city = $("#countys").val();
		var uname = $("#myname").val();
		var utel = $("#myphone").val();
		var address = $("#myaddr").val();
		
		var time = $("#start").val();

	$.post("{:url('address_do')}",{"sn": sncode,"psw": pswcode,"uname":uname,"utel":utel,"city":city,"address":address,"get0_time":time},function (data) {
		console.log(data);

	}, 'json');
	return false;


});



 

</script>