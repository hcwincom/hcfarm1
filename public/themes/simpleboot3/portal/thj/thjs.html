<script>
	var city_url = "{:url('portal/public/city')}";
	city(0);
	function city(city = 0) {
		var provinces = $("#provinces");
		$.post(city_url, { 'city': city }, function (data) {
			if (data.code != 1) {
				return false;
			}
			var citys = data.data.citys;
			var options = '';
		
			for (var i in citys) {
				options += '<option value="' + i + '">' + citys[i] + '</option>';
			}
		
			provinces.append(options);

		}, 'json');
	}

	$("#provinces").change(function () {
		$.post(city_url, { 'city': $(this).val() }, function (data) {
			if (data.code != 1) {
				return false;
			}

			var citys = data.data.citys;
			var options = '';

			for (var i in citys) {
				options += '<option class="city2" value="' + i + '">' + citys[i] + '</option>';
			}

			$("#citysel .city2").remove();
			$("#countys .city3").remove();
			$("#citysel").append(options);
			$("#citysel .city0").prop('selected', true)

		}, 'json');
		$("#citysel").val();
	});
	$("#citysel").change(function () {
		$("#countys").val(0);
		$.post(city_url, { 'city': $(this).val() }, function (data) {
			if (data.code != 1) {
				return false;
			}
			var citys = data.data.citys;
			var options = '';

			for (var i in citys) {
				options += '<option class="city3" value="' + i + '">' + citys[i] + '</option>';
			}
			$("#countys .city3").remove();
			$("#countys").append(options);
			$("#countys .city0").prop('selected', true)


		}, 'json');
	});

	// 提货方式
	var citys_network_url = "{:url('portal/public/citys_network')}";
		storeCitySelect();			
		//获取提货点城市
		function storeCitySelect() {			
			$.post(citys_network_url, {'dd':'dd'}, function (data) {
				
				if (data.code != 1) {
					return false;
				}
				var citys = data.data.citys;
				var options = '';
				for (var i in citys) {
					options += '<option class="cityStore" value="' + i + '">' + citys[i] + '</option>';
				}
				$("#storeCity").append(options);
			
			}, 'json');
		}
	

		var city_networks_url = "{:url('portal/public/city_networks')}";
		$("#storeCity").change(function () {
				//获取对应城市的提货点
			$.post(city_networks_url, { 'city': $(this).val() }, function (data) {
				if (data.code != 1) {
					return false;
				}
				
				var lists = data.data.lists;
				var options = '';
				for(var i in lists){
					options += '<option class="store" value="' + i + '">' + lists[i] + '</option>';
				}
				// console.log(lists);
				$("#storeaddr .store").remove();
				$("#storeaddr").append(options);
				$("#storeaddr .store0").prop('selected',true);
			}, 'json');

		});
	


//  验证提货券

$('#goods_verify').submit(function(){
	var form_check=pickGoods();
	console.log('ssssssss');
	if(form_check==false){
		return false;
	}
	

	$('#info').hide();
	$(".cardGoods").hide();
	$(".personInfo").hide();
	$(".storeGoods").hide();
		
	var sn=$('#code').val();
	var psw=$('#password').val();
	var verify=$('#checkcode').val();
	$.post("{:url('portal/thj/verify')}",{'sn':sn,'psw':psw,'verify':verify},function(data){
		if(data.code!=1){ 
			$(".indyz2").html(data.msg);
			$('.codeImg').attr('src',$('.codeImg').attr('src')+';1');
			return false;
		}
		$(".indyz2").html("");
		//获取卡券数据赋值
		var info=data.data.info;
		console.log(info);
		console.log(info.network);
		$('#info').show();
		$('#info .show_price em').text(info['show_money']);
		$('#info .status em').remove();
		
		//按状态显示
		// 'voucher_status'=>[
				// 1=>'系统生成',
				// 2=> '已导出',
				// 3=> '已发放',
				// 4=> '已提货',
				// 5=> '已发货',
				// 6=> '已收货',
				// 7=> '已退货',
				// 8=> '售后结束',

//         ],
		
		var value_time1 = timestampToTime(info.value_time1);
		var value_time2 = timestampToTime(info.value_time2);
		$(".sn em").text(info.sn);
		var send_time = timestampToTime(info.send_time);
		var express_time = timestampToTime(info['express_time']);
		var expressHref = $(".express_odd a").attr("href")
		console.log(express_time);
		console.log(info.status);
		// 查看图片显示信息
		$(".value_time1 em").text(value_time1);
		$(".value_time2 em").text(value_time2);
		$(".modeal_name").text(info.name);
		$(".modeal_model").text(info.model);
		$(".modeal_num").text(info.num);
		$(".modeal_color").text(info.color);

		if(info.status=='3'){ 
			$('#info .status').append('<em class="redcolor">未提货</em>');
			$('#info').show();
			$(".personInfo").show();
			$("#codeNum").val(info.sn);
			$("#codePwd").val(info.psw);

			return false;
		} 

		//已提货显示提货信息
		if(parseInt(info.status) == '4'){
			$('#info .status').append('<em class="greenc">已申请提货</em>');
			$('#info').show();
			$(".cardGoods").show();
			$(".uname em").text(info['uname']);
			$(".utel em").text(info['utel']);
			if(info.network == '0'){
				$(".city_name em").text(info['city_name'] + info['address']);
				$(".express_time em").text('--');
				$(".express_odd a").remove();
				$(".express_odd").append('<em>--</em>')
			}else{
				$(".city_name").text("");
				$(".express_time").text("");
				$(".cardGoods_info").append('<p class="redcolor">门店提货</p>');

			}
			
			return false;
		}

		//已发货显示提货信息
		if(parseInt(info.status) == '5'){
			$('#info .status').append('<em class="greenc">已发货</em>');
			$('#info').show();
			$(".cardGoods").show();
			$(".uname em").text(info['uname']);
			$(".utel em").text(info['utel']);
			if (info.network == '0') {
				$(".city_name em").text(info['city_name'] + info['address']);
				$(".express_time em").text(express_time);
				$(".express_odd a").attr("href", expressHref + info['express']);
				$(".express_odd a").text(info['express']);	
			} else {
				$(".city_name").text("");
				$(".express_time").text("");
				$(".cardGoods_info").append('<p class="redcolor">门店提货</p>');
			}

			return false;
		}
		if (parseInt(info.status) == '6') {
			$('#info .status').append('<em class="greenc">已发货</em>');
			$('#info').show();
			$(".cardGoods").show();
			$(".uname em").text(info['uname']);
			$(".utel em").text(info['utel']);
			if (info.network == '0') {
				$(".city_name em").text(info['city_name'] + info['address']);
				$(".express_time em").text(express_time);
				$(".express_odd a").attr("href", expressHref + info['express']);
				$(".express_odd a").text(info['express']);
			} else {
				$(".city_name").text("");
				$(".express_time").text("");
				$(".cardGoods_info").append('<p class="redcolor">门店提货</p>');
			}

			return false;
		}

		if (parseInt(info.status) == '7') {
			$('#info .status').append('<em class="greenc">退货</em>');
			$('#info').show();
			$(".cardGoods").show();
			$(".uname em").text(info['uname']);
			$(".utel em").text(info['utel']);
			if (info.network == '0') {
				$(".city_name em").text(info['city_name'] + info['address']);
				$(".express_time em").text(express_time);
				$(".express_odd a").attr("href", expressHref + info['express']);
				$(".express_odd a").text(info['express']);
				$(".cardGoods_info").append('<p class="redcolor">申请退货</p>');
			} else {
				$(".city_name").text("");
				$(".express_time").text("");
				$(".cardGoods_info").append('<p class="redcolor">门店提货</p>');
			}

			return false;
		}
		

		 
		$(".uname em").text(info['uname']);
		$(".utel em").text(info['utel']);
		$(".city_name em").text(info['city_name'] + info['address']);
		$(".express_time em").text(express_time);
		$(".express_odd a").attr("href", expressHref + info['express']);
		$(".express_odd a").text(info['express']);
		
		$('#address_btn').hide();
	},'json');
	
	return false;
});




//  
	$("#racheck").click(function () {
		$(".onlineGoods").show();
		$(".storeGoods").hide();
	})

	$("#radiocheck").click(function () {
		$(".onlineGoods").hide();
		$(".storeGoods").show();
	});	


	// 提货信息验证
	$("#pickBtn").click(function () {
		if ($.trim($("#myname").val()) == "") {
			$("#myname").focus();
			$(".codeMsg").html("请填写联系人姓名");
			return false;
		} else if ($.trim($("#myphone").val()) == "" || isPhoneNo($.trim($("#myphone").val())) == false) {
			$("#myphone").focus();
			$(".codeMsg").html("请填写联系人手机号码");
			return false;
		}else{
			$(".codeMsg").html("");
			return true;
		}
	
		var sncode = $("#codeNum").val();
		var pswcode = $("#codePwd").val();
		var city = $("#countys").val();
		var uname = $("#myname").val();
		var utel = $("#myphone").val();
		var address = $("#myaddr").val();
		var take_dsc = $("input[name='beizhu']").val();
		
		var time = $("#start").val();

		var storeaddr = $("#storeaddr").val();
		 
		var checked = $("input[name='take_type']:checked").val();
		

		if(checked == 1){
				
			if ($.trim($("#countys").val()) == "0") {
				$(".codeMsg").html("请填写地址");
				return false;
			}else{
				$(".codeMsg").html("");
				return true;
			}

			if ($.trim($("textarea[name='myaddr']").val()) == "") {
				$("#myaddr").focus();
				$(".codeMsg").html("请填写详细地址");
				return false;
			}else{
				$(".codeMsg").html("");
				return true;
			}
			$.post("{:url('address_do')}", { "sn": sncode, "psw": pswcode, "uname": uname, "utel": utel, "city": city, "address": address, "get0_time": time, "take_dsc": take_dsc,'take_type':1}, function (data) {
				console.log(data);
				$(".codeMsg").html(data.msg);
				if (data.code != 1) {
					return false;
				}
				$('#address_btn').hide();

			}, 'json');
		}else if(checked == 2){
			$.post("{:url('address_do')}",{ "sn": sncode, "psw": pswcode, "uname": uname, "utel": utel,'network': storeaddr, "take_dsc": take_dsc,'take_type':2},function (data) {
				if(data.code != 1){
					return false;
				}
				$('#address_btn').hide();
			});
		}
	
	return false;


});

	 function timestampToTime(timestamp) {
			var date = new Date(timestamp * 1000);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
			var Y = date.getFullYear() + '-';
			var M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
			var D = (date.getDate()<10 ? '0' + (date.getDate()) : date.getDate()) + ' ';
			return Y + M + D;
		}
 

</script>